---
description: Project context for new sessions
alwaysApply: true
---

# Content Engine

> Internal AI platform. Stores company knowledge in Weaviate, retrieves via semantic search, sends context + prompt to Claude for content generation.

## Stack

| Layer | Choice |
|---|---|
| Framework | Next.js 16, App Router, TypeScript |
| Styling | Tailwind CSS v4 |
| Vector DB | Weaviate Cloud (`weaviate-client` v3) |
| LLM | Anthropic Claude (`claude-opus-4-5`) via `lib/claude.ts` |
| Deploy | Vercel (pending) |

## Repo Structure

```
app/
  page.tsx                — Dashboard with connection status badges
  layout.tsx              — Root layout, Geist font
  api/chat/route.ts       — POST, streams Claude response
  api/knowledge/route.ts  — GET list, POST create
  api/knowledge/[id]/route.ts — GET detail, PUT update, DELETE, PATCH deprecate/restore
  api/dashboard/route.ts  — GET health metrics (counts, staleness, gaps)
  api/submissions/route.ts — GET list, POST create submissions
  api/submissions/[id]/route.ts — GET submission detail
  api/submissions/[id]/review/route.ts — POST accept/reject/defer
  api/submissions/[id]/merge/route.ts — POST stream AI merge
  api/submissions/[id]/merge/save/route.ts — POST save merged content
  api/bulk-upload/parse/route.ts — POST parse files, create upload session (G3)
  api/bulk-upload/classify/route.ts — POST classify documents via AI, SSE stream (G2, updated for G3)
  api/bulk-upload/session/[sessionId]/route.ts — GET upload session state (G3)
  api/bulk-upload/reclassify/route.ts — POST reclassify single document (G3)
  api/bulk-upload/approve/route.ts — POST approve documents, create submissions (G5)
  bulk-upload/page.tsx — Bulk upload wizard page (G4)
  bulk-upload/components/ — FileDropZone, ClassificationProgress, DocumentReviewCard, TagEditor, ConfidenceBadge
  knowledge/page.tsx      — Knowledge Base list page (filter tabs, search)
  knowledge/[id]/page.tsx — Knowledge Base detail page (markdown, sidebar, actions)
  knowledge/new/page.tsx  — Create form page
  knowledge/[id]/edit/page.tsx — Edit form page
  knowledge/components/   — KnowledgeList, KnowledgeForm, DetailActions, TypeBadge, MarkdownRenderer
  queue/page.tsx          — Review queue list page (filter tabs, show-closed toggle)
  queue/[id]/page.tsx     — Submission review page (preview, diff, actions)
  queue/components/       — SubmissionList, SubmissionReview, ContentDiff, MergeEditor, VisualDiff
  api/skills/route.ts     — GET list, POST create skills
  api/skills/[id]/route.ts — GET detail, PUT update, DELETE, PATCH activate/deactivate/deprecate/restore
  skills/page.tsx         — Skills Library list page (filter tabs, search)
  skills/[id]/page.tsx    — Skill detail page (markdown, sidebar, actions)
  skills/new/page.tsx     — Create skill form page
  skills/[id]/edit/page.tsx — Edit skill form page
  skills/components/      — SkillList, SkillForm, SkillDetailActions
  components/             — RoleProvider, RoleToggle
  dashboard/page.tsx      — Health dashboard (stat cards, gap report, staleness, queue count)
  dashboard/components/   — StatCard, GapTable, StalenessList
lib/
  weaviate.ts             — withWeaviate<T>(fn), checkWeaviateConnection()
  claude.ts               — streamMessage(), checkClaudeConnection()
  knowledge.ts            — CRUD operations: list, get, create, update, delete, deprecate/restore
  knowledge-types.ts      — Client-safe types, input types, utilities
  dashboard.ts            — getDashboardData() health metrics aggregation
  submissions.ts          — Submission CRUD: create, list, get, review, countPending
  submission-types.ts     — Submission types, status enums, utilities
  merge.ts                — buildMergePrompt() for AI merge workflow
  document-parser.ts      — File parsing: md, pdf, docx, txt (G1)
  document-parser-types.ts — ParsedDocument, ParseOptions, ParseResult types
  classifier.ts           — AI document classification via Claude (G2)
  classification-types.ts — ClassificationResult, SuggestedRelationship types
  upload-session.ts       — In-memory upload session store with 24h TTL (G3)
  upload-session-types.ts — UploadSession, UploadSessionState types (G3)
  skills.ts               — Skill CRUD operations: list, get, create, update, delete, activate/deactivate, deprecate/restore
  skill-types.ts          — Skill types, content type constants, category constants, utilities
  context-assembly.ts     — assembleContext() for building generation system prompts with skills + knowledge + rules
docs/
  PRD.md                  — Functional requirements and user stories
  TECH_DECISIONS.md       — Architecture decision records
  BUSINESS_LOGIC.md       — Context assembly, content types, skills vs rules, runtime logic
  KNOWLEDGE_BASE.md       — Weaviate schema (incl. Skill collection), content inventory, seed plan
  SCOPE.md                — Project overview, goals, status
  ROADMAP.md              — Phases, future modules, backlog, open questions
  CHANGELOG.md            — What was built and when
  API.md                  — API route contracts (incl. planned bulk upload, skills routes)
  user-guides/            — End-user guides per feature (getting-started, knowledge-base, managing-knowledge, relationships, health-dashboard, review-queue, ai-merge, enhanced-review, external-api [draft])
.env.example              — Environment variable template (current + planned vars)
```

## Current Phase: 1

| Module | Status |
|---|---|
| Dashboard | Done |
| Knowledge Base (Read) | Done (Group A) |
| Knowledge Base (CRUD) | Done (Group B) |
| Knowledge Base (Relationships) | Done (Group C) |
| Knowledge Base (Health Dashboard) | Done (Group D) |
| Knowledge Base (Review Queue) | Done (Group E) |
| Knowledge Base (AI Merge) | Done (Group F) |
| Knowledge Base (Bulk Upload) | Done (Group G) |
| Knowledge Base (Enhanced Review) | Done (Group H) |
| Skills Module | Done (Group I) |
| Inbound MCP Server (3rd Party Write) | Scoped (Group J) |
| External REST API (3rd Party Read) | Scoped (Group K) |
| LLM MCP Server (RAG Read Access) | Scoped (Group L) |
| Generate (content creation) | Pending |
| Content Library | Future (Phase 2) |
| Workflows | Future (Phase 2) |

## Detail Pointers

- Weaviate schema, seed inventory, connection pattern: `docs/KNOWLEDGE_BASE.md`
- API contracts: `docs/API.md`
- Content types, context assembly, skills vs rules: `docs/BUSINESS_LOGIC.md`
- Tech decisions and rationale: `docs/TECH_DECISIONS.md`
- Full requirements and user stories: `docs/PRD.md`
- Future phases, backlog, open questions: `docs/ROADMAP.md`
- End-user feature guides: `docs/user-guides/`
